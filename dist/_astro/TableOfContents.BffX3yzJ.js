import{r as l,j as r}from"./react-core.BIN8wETl.js";import{A as T}from"./accordion.DGeF2B0P.js";import"./scroll-observer.EoeTqr10.js";import"./ui-primitives.BFDU8kZC.js";import"./visibility-hooks.ApgVvsI_.js";import"./engagement-hooks.Cx20y_gM.js";const G=h=>h.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").slice(0,80),w="h2, h3";function z({id:h,className:y="",contentId:p,title:u="Table of Contents",headingSelector:b=w,scrollOffset:C=140,emptyLabel:$="Headings will appear here automatically."}){const x=h??`${p}-toc`,A=`${x}-list`,[a,k]=l.useState([]),[c,m]=l.useState(null),[I,f]=l.useState({}),[v,B]=l.useState(!1),j=l.useMemo(()=>b.split(",").map(t=>t.trim()).filter(Boolean).join(", ")||w,[b]);l.useEffect(()=>{const t=document.getElementById(p);if(!t)return;const e=Array.from(t.querySelectorAll(j)).map((s,i)=>{const d=s.textContent?.trim();if(!d)return null;const g=Number.parseInt(s.tagName.replace("H",""),10)||2;return s.id||(s.id=`${p}-${G(d)}-${i}`),s.dataset.tocAnchor=s.id,{id:s.id,text:d,level:g,element:s}}).filter(Boolean),n=[];if(e.forEach(s=>{s.level<=2||n.length===0?n.push({parent:s,children:[]}):n[n.length-1].children.push(s)}),k(n),e.length>0&&m(s=>s??e[0].id),e.length===0)return;const o=new IntersectionObserver(s=>{s.forEach(i=>{i.isIntersecting&&m(i.target.id)})},{rootMargin:"-45% 0px -45% 0px",threshold:.15});return e.forEach(({element:s})=>o.observe(s)),()=>{o.disconnect()}},[p,j]),l.useEffect(()=>{a.length!==0&&f(()=>{const t={};return a.forEach((e,n)=>{t[e.parent.id]=n===0}),t})},[a]),l.useEffect(()=>{if(!c||a.length===0)return;const t=a.find(e=>e.parent.id===c||e.children.some(n=>n.id===c));t&&f(()=>{const e={};return a.forEach(n=>{e[n.parent.id]=n.parent.id===t.parent.id}),e})},[c,a]);const N=t=>{const e=document.getElementById(t);if(!e)return;const n=window.matchMedia("(prefers-reduced-motion: reduce)"),o=e.getBoundingClientRect().top+window.scrollY-C;window.scrollTo({top:o,behavior:n.matches?"auto":"smooth"}),m(t),history.replaceState(null,"",`#${t}`)},S=(t,e)=>{t.preventDefault(),f(()=>{const n={};return a.forEach(o=>{n[o.parent.id]=o.parent.id===e}),n}),N(e)},M=(t,e)=>{t.preventDefault(),N(e)},E=r.jsx("ol",{id:A,className:"space-y-3 list-none p-0 m-0",children:a.length===0?r.jsx("li",{className:"py-3 text-sm text-muted",children:$}):a.map(t=>{const e=t.parent.id,n=!!I[e],o=c===e||t.children.some(i=>i.id===c),s=`${e}-children`;return r.jsxs("li",{className:"rounded-2xl list-none",children:[r.jsx("button",{type:"button",className:`w-full flex items-center justify-between gap-3 px-4 py-3 text-left text-sm md:text-base no-underline transition-colors duration-200 hover:text-primary focus-visible:text-heading ${o?"text-accent font-semibold":"text-text"}`,"aria-expanded":n,"aria-controls":s,onClick:i=>S(i,e),children:r.jsx("span",{className:"flex-1 text-left leading-tight",children:t.parent.text})}),t.children.length>0&&r.jsx("ol",{id:s,className:`${n?"flex":"hidden"} flex-col gap-2 px-4 pb-3 pl-4 m-0 list-none`,"aria-hidden":!n,children:t.children.map(i=>{const d=i.id===c;return r.jsx("li",{className:"list-none",children:r.jsx("a",{href:`#${i.id}`,className:`flex items-start gap-3 text-sm no-underline transition-colors duration-200 hover:text-primary focus-visible:text-primary ${d?"text-heading font-semibold":"text-muted"}`,"aria-current":d,onClick:g=>M(g,i.id),children:r.jsx("span",{className:"flex-1 text-left leading-tight",children:i.text})})},i.id)})})]},e)})});return r.jsxs("nav",{id:x,className:y,"aria-label":u,children:[r.jsx("div",{className:"lg:hidden",children:r.jsx(T,{id:`${x}-mobile`,title:u,isExpanded:v,onToggle:()=>B(!v),headerClassName:"text-sm uppercase tracking-widest font-semibold text-muted",showIndicator:!0,children:E})}),r.jsxs("div",{className:"hidden lg:block card-bg faded-border rounded-3xl p-6 shadow-2xl",children:[r.jsx("div",{className:"flex items-center justify-center gap-4",children:r.jsx("p",{className:"text-[0.7rem] uppercase tracking-[0.3em] font-semibold text-muted",children:u})}),r.jsx("div",{className:"mt-4",children:E})]})]})}export{z as default};
