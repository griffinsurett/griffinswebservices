import{r as n,j as l}from"./react-core.D7tCyleJ.js";import{u as U}from"./useEngagementAutoScroll.CrKEMT7E.js";import{g as L}from"./layoutHelpers.DmHfmlAk.js";import"./useVisibility.DQCZqB_X.js";const z=700,k=14,N=k*1e3,H=28,$=4,q=220,W=16,B=2200,Y=450,G=750;function V({item:o,mediaEntry:s,totalSlides:w,activeIndex:c,onCycleComplete:M,autoplayEnabled:i=!0,isActive:j}){const S=n.useRef(null),[R,v]=n.useState(!1),[f,h]=n.useState(!1),[p,g]=n.useState(N),[x,_]=n.useState(0),A=n.useCallback(e=>{const t=Math.max(0,e.scrollHeight-e.clientHeight);if(t<=0)return 0;const r=t/k;return!Number.isFinite(r)||r<=0?H:Math.max(H,r)},[]),O=n.useCallback(e=>{const t=Math.max(0,e.scrollHeight-e.clientHeight);if(t<=0)return N;const r=A(e);if(r<=0)return N;const d=Math.round(t/r*1e3);return!Number.isFinite(d)||d<=0?N:Math.max(N,d)},[A]),C=U({ref:S,active:i&&f,speed:A,loop:!1,startDelay:z,resumeDelay:600,resumeOnUserInput:!0,threshold:.05,resetOnInactive:!1});n.useEffect(()=>{i&&(C.resetPosition(0),S.current?.scrollTo({top:0,left:0,behavior:"auto"}))},[i,C.resetPosition]),n.useEffect(()=>{const e=S.current;if(!e)return;const t=e.querySelector("picture img")??e.querySelector("img");if(!t){v(!0);return}if(t.complete&&t.naturalHeight>0){v(!0);return}v(!1);const r=()=>v(!0);return t.addEventListener("load",r,{once:!0}),t.addEventListener("error",r,{once:!0}),()=>{t.removeEventListener("load",r),t.removeEventListener("error",r)}},[o,s]),n.useEffect(()=>{if(!R){h(!1);return}const e=S.current;if(!e)return;let t=!1,r=null;const d=()=>Math.max(0,e.scrollHeight-e.clientHeight)>$,T=()=>{t||(t=!0,r?.(),r=null,h(!0))},b=()=>{if(typeof ResizeObserver>"u"){T();return}let a=null,y=e.scrollHeight;const D=()=>{a||(a=window.setTimeout(()=>{a=null,T()},q))},F=()=>{a&&(window.clearTimeout(a),a=null)},I=new ResizeObserver(()=>{const P=e.scrollHeight;Math.abs(P-y)>W&&(y=P,F()),D()});I.observe(e),D(),r=()=>{I.disconnect(),a&&(window.clearTimeout(a),a=null)}};if(d())b();else if(typeof ResizeObserver<"u"){const a=new ResizeObserver(()=>{d()&&(a.disconnect(),b())});a.observe(e),r=()=>a.disconnect()}else T();const E=window.setTimeout(()=>{T()},B);return()=>{r?.(),window.clearTimeout(E)}},[R]),n.useEffect(()=>{if(!f||!i){g(N);return}const e=S.current;if(!e)return;const t=()=>g(O(e));t();const r=typeof ResizeObserver<"u"?new ResizeObserver(()=>t()):null;return r?.observe(e),()=>r?.disconnect()},[f,O]),n.useEffect(()=>{if(!f||!i||w<=1||C.paused)return;const e=z+p+Y,t=window.setTimeout(()=>M(),e);return()=>window.clearTimeout(t)},[i,f,M,p,w,C.paused]),n.useEffect(()=>{if(!f||!j){_(0);return}let e=null;const t=()=>{const r=S.current;if(r){const d=Math.max(0,r.scrollHeight-r.clientHeight),T=d>0?r.scrollTop/d*100:0;_(Math.round(T))}e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),()=>{e&&cancelAnimationFrame(e)}},[f,j]);const u=L(o.featuredImage)||L(o.bannerImage)||L(o.image)||"",m=()=>s?.sources?.length?l.jsxs("picture",{children:[s.sources.map((e,t)=>l.jsx("source",{srcSet:e.srcSet,sizes:e.sizes??s.sizes,type:e.type},`${o.slug??o.id??t}-source-${t}`)),l.jsx("img",{src:s.src,srcSet:s.srcSet,sizes:s.sizes,alt:s.alt||o.alt||o.title||"Project preview",width:s.width,height:s.height,loading:s.loading??"lazy",decoding:s.decoding??"async",fetchPriority:s.fetchPriority,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"})]}):s?.src?l.jsx("img",{src:s.src,srcSet:s.srcSet,sizes:s.sizes,alt:s.alt||o.alt||o.title||"Project preview",width:s.width,height:s.height,loading:s.loading??"lazy",decoding:s.decoding??"async",fetchPriority:s.fetchPriority,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"}):u?l.jsx("img",{src:u,alt:o.alt||o.title||"Project preview",loading:"eager",draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top",decoding:"async"}):l.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-b from-bg2 via-bg to-bg/80 text-white/30",children:"Preview coming soon"});return o.client||o.title,`${String(c+1).padStart(2,"0")}${String(w).padStart(2,"0")}`,l.jsx("div",{className:"relative h-full w-full",children:l.jsxs("div",{className:"relative h-full bg-bg3",children:[l.jsx("div",{className:"flex flex-col gap-3 border-b border-white/10 px-4 py-3 text-white/70 sm:flex-row sm:items-center sm:justify-between",children:l.jsx("div",{className:"flex items-center gap-3 text-xs uppercase tracking-[0.35em] text-white/50",children:l.jsxs("span",{className:"flex items-center gap-1.5",children:[l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"})]})})}),l.jsx("figure",{ref:S,className:"relative h-full overflow-y-auto overscroll-contain bg-black/40",style:{WebkitOverflowScrolling:"touch"},children:m()}),!1]})})}function Z({items:o=[],className:s="",mediaEntries:w=[]}){const c=n.useMemo(()=>Array.isArray(o)?o:[],[o]),M=n.useMemo(()=>Array.isArray(w)?w:[],[w]),[i,j]=n.useState(0),[S,R]=n.useState(0),[v,f]=n.useState(null),[h,p]=n.useState("idle"),g=n.useRef(null),x=n.useRef(null);n.useEffect(()=>{if(!c.length){j(0),R(0),f(null),p("idle");return}j(u=>u>=c.length?0:u)},[c.length]),n.useEffect(()=>()=>{g.current&&(window.clearTimeout(g.current),g.current=null),x.current&&(cancelAnimationFrame(x.current),x.current=null)},[]);const _=n.useCallback(u=>{typeof window>"u"||(f(i),j(u),p("pre"),x.current&&(cancelAnimationFrame(x.current),x.current=null),x.current=requestAnimationFrame(()=>{x.current=requestAnimationFrame(()=>{p("animating")})}),g.current&&(window.clearTimeout(g.current),g.current=null),g.current=window.setTimeout(()=>{p("idle"),f(null),R(m=>m+1)},G))},[i]),A=n.useCallback(()=>{if(!c.length||c.length<=1||h!=="idle")return;const u=(i+1)%c.length;_(u)},[i,c.length,_,h]);if(!c.length)return null;c[i];const O="absolute inset-0 transition-transform transition-opacity duration-[750ms] ease-[cubic-bezier(0.4,0,0.2,1)]";return l.jsx("div",{className:`relative ${s}`.trim(),children:l.jsx("div",{className:"relative mx-auto w-full max-w-4xl overflow-hidden h-[420px] sm:h-[500px]",children:c.map((u,m)=>{const e=m===i,t=m===v,r=e||t&&h!=="idle",d=(i+1)%c.length;if(!(e||t||m===d))return null;let b="translate-x-full";return t&&h!=="idle"?b="-translate-x-full":e&&(h==="idle"||v===null?b="translate-x-0":h==="pre"?b="translate-x-full":b="translate-x-0"),l.jsx("div",{className:`${O} ${b} ${r?"opacity-100":"opacity-0 pointer-events-none"}`,"aria-hidden":e?"false":"true",children:l.jsx(V,{item:u,mediaEntry:M[m],totalSlides:c.length||1,activeIndex:m,onCycleComplete:A,autoplayEnabled:e&&h==="idle",isActive:e})},u.slug??u.id??m)})})})}export{Z as default};
