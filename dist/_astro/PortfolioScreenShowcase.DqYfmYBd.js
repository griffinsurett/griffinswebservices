import{r as t,j as i}from"./react-core.KjzrvO5l.js";import{u as q}from"./useEngagementAutoScroll.DHdhpLcw.js";import{g as M}from"./layoutHelpers.DmHfmlAk.js";import"./useVisibility.B645O2tJ.js";const z=700,U=14,j=U*1e3,H=28,B=4,W=220,Y=16,G=2200,V=450,X=750;function J(){const[o,r]=t.useState(!1);return t.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia>"u")return;const a=window.matchMedia("(min-width: 1024px)"),l=S=>{r(S.matches)};return l(a),typeof a.addEventListener=="function"?(a.addEventListener("change",l),()=>a.removeEventListener("change",l)):(a.addListener(l),()=>a.removeListener(l))},[]),o}function K({item:o,mediaEntry:r,totalSlides:a,activeIndex:l,onCycleComplete:S,autoplayEnabled:f=!0,isActive:R,shouldUseDesktopEager:O}){const p=t.useRef(null),[N,v]=t.useState(!1),[c,b]=t.useState(!1),[m,g]=t.useState(j);t.useRef(0);const _=t.useCallback(e=>{const s=Math.max(0,e.scrollHeight-e.clientHeight);if(s<=0)return 0;const n=s/U;return!Number.isFinite(n)||n<=0?H:Math.max(H,n)},[]),C=t.useCallback(e=>{const s=Math.max(0,e.scrollHeight-e.clientHeight);if(s<=0)return j;const n=_(e);if(n<=0)return j;const h=Math.round(s/n*1e3);return!Number.isFinite(h)||h<=0?j:Math.max(j,h)},[_]),T=q({ref:p,active:f&&c,speed:_,loop:!1,startDelay:z,resumeDelay:600,resumeOnUserInput:!0,threshold:.05,resetOnInactive:!1});t.useEffect(()=>{f&&(T.resetPosition(0),p.current?.scrollTo({top:0,left:0,behavior:"auto"}))},[f,T.resetPosition]),t.useEffect(()=>{const e=p.current;if(!e)return;const s=e.querySelector("picture img")??e.querySelector("img");if(!s){v(!0);return}if(s.complete&&s.naturalHeight>0){v(!0);return}v(!1);const n=()=>v(!0);return s.addEventListener("load",n,{once:!0}),s.addEventListener("error",n,{once:!0}),()=>{s.removeEventListener("load",n),s.removeEventListener("error",n)}},[o,r]),t.useEffect(()=>{if(!N){b(!1);return}const e=p.current;if(!e)return;let s=!1,n=null;const h=()=>Math.max(0,e.scrollHeight-e.clientHeight)>B,y=()=>{s||(s=!0,n?.(),n=null,b(!0))},D=()=>{if(typeof ResizeObserver>"u"){y();return}let u=null,E=e.scrollHeight;const k=()=>{u||(u=window.setTimeout(()=>{u=null,y()},W))},$=()=>{u&&(window.clearTimeout(u),u=null)},I=new ResizeObserver(()=>{const P=e.scrollHeight;Math.abs(P-E)>Y&&(E=P,$()),k()});I.observe(e),k(),n=()=>{I.disconnect(),u&&(window.clearTimeout(u),u=null)}};if(h())D();else if(typeof ResizeObserver<"u"){const u=new ResizeObserver(()=>{h()&&(u.disconnect(),D())});u.observe(e),n=()=>u.disconnect()}else y();const F=window.setTimeout(()=>{y()},G);return()=>{n?.(),window.clearTimeout(F)}},[N]),t.useEffect(()=>{if(!c||!f){g(j);return}const e=p.current;if(!e)return;const s=()=>g(C(e));s();const n=typeof ResizeObserver<"u"?new ResizeObserver(()=>s()):null;return n?.observe(e),()=>n?.disconnect()},[c,C]),t.useEffect(()=>{if(!c||!f||a<=1||T.paused)return;const e=z+m+V,s=window.setTimeout(()=>S(),e);return()=>window.clearTimeout(s)},[f,c,S,m,a,T.paused]),t.useEffect(()=>{},[c,R]);const L=M(o.featuredImage)||M(o.bannerImage)||M(o.image)||"",A=!!(r?.desktopEager&&O),d=A?"eager":r?.loading??"lazy",w=A?"high":r?.fetchPriority??"auto",x=()=>r?.sources?.length?i.jsxs("picture",{children:[r.sources.map((e,s)=>i.jsx("source",{srcSet:e.srcSet,sizes:e.sizes??r.sizes,type:e.type},`${o.slug??o.id??s}-source-${s}`)),i.jsx("img",{src:r.src,srcSet:r.srcSet,sizes:r.sizes,alt:r.alt||o.alt||o.title||"Project preview",width:r.width,height:r.height,loading:d,decoding:r.decoding??"async",fetchPriority:w,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"})]}):r?.src?i.jsx("img",{src:r.src,srcSet:r.srcSet,sizes:r.sizes,alt:r.alt||o.alt||o.title||"Project preview",width:r.width,height:r.height,loading:d,decoding:r.decoding??"async",fetchPriority:w,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"}):L?i.jsx("img",{src:L,alt:o.alt||o.title||"Project preview",loading:A?"eager":"lazy",draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top",decoding:"async",fetchPriority:A?"high":"auto"}):i.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-b from-bg2 via-bg to-bg/80 text-white/30",children:"Preview coming soon"});return o.client||o.title,`${String(l+1).padStart(2,"0")}${String(a).padStart(2,"0")}`,i.jsx("div",{className:"relative h-full w-full",children:i.jsxs("div",{className:"relative h-full bg-bg3",children:[i.jsx("div",{className:"flex flex-col gap-3 border-b border-white/10 px-4 py-3 text-white/70 sm:flex-row sm:items-center sm:justify-between",children:i.jsx("div",{className:"flex items-center gap-3 text-xs uppercase tracking-[0.35em] text-white/50",children:i.jsxs("span",{className:"flex items-center gap-1.5",children:[i.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),i.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),i.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"})]})})}),i.jsx("figure",{ref:p,className:"relative h-full overflow-y-auto overscroll-contain bg-black/40",style:{WebkitOverflowScrolling:"touch"},children:x()}),!1]})})}function re({items:o=[],className:r="",mediaEntries:a=[]}){const l=t.useMemo(()=>Array.isArray(o)?o:[],[o]),S=t.useMemo(()=>Array.isArray(a)?a:[],[a]),[f,R]=t.useState(0),[O,p]=t.useState(0),[N,v]=t.useState(null),[c,b]=t.useState("idle"),m=t.useRef(null),g=t.useRef(null),_=J();t.useEffect(()=>{if(!l.length){R(0),p(0),v(null),b("idle");return}R(d=>d>=l.length?0:d)},[l.length]),t.useEffect(()=>()=>{m.current&&(window.clearTimeout(m.current),m.current=null),g.current&&(cancelAnimationFrame(g.current),g.current=null)},[]);const C=t.useCallback(d=>{typeof window>"u"||(v(f),R(d),b("pre"),g.current&&(cancelAnimationFrame(g.current),g.current=null),g.current=requestAnimationFrame(()=>{g.current=requestAnimationFrame(()=>{b("animating")})}),m.current&&(window.clearTimeout(m.current),m.current=null),m.current=window.setTimeout(()=>{b("idle"),v(null),p(w=>w+1)},X))},[f]),T=t.useCallback(()=>{if(!l.length||l.length<=1||c!=="idle")return;const d=(f+1)%l.length;C(d)},[f,l.length,C,c]);if(!l.length)return null;l[f];const L="absolute inset-0 transition-transform transition-opacity duration-[750ms] ease-[cubic-bezier(0.4,0,0.2,1)]";return i.jsx("div",{className:`relative ${r}`.trim(),children:i.jsx("div",{className:"relative mx-auto w-full max-w-4xl overflow-hidden rounded-lg h-[420px] sm:h-[500px]",children:l.map((d,w)=>{const x=w===f,e=w===N,s=x||e&&c!=="idle";if(!(x||e&&c!=="idle"))return null;let h="translate-x-full";return e&&c!=="idle"?h="-translate-x-full":x&&(c==="idle"||N===null?h="translate-x-0":c==="pre"?h="translate-x-full":h="translate-x-0"),i.jsx("div",{className:`${L} shadow-2xl ${h} ${s?"opacity-100":"opacity-0 pointer-events-none"}`,"aria-hidden":x?"false":"true",children:i.jsx(K,{item:d,mediaEntry:S[w],totalSlides:l.length||1,activeIndex:w,onCycleComplete:T,autoplayEnabled:x&&c==="idle",isActive:x,shouldUseDesktopEager:_})},d.slug??d.id??w)})})})}export{re as default};
