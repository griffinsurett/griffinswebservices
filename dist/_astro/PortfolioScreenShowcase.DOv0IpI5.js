import{r as s,j as l}from"./react-core.QUkC7_l_.js";import{u as W}from"./useEngagementAutoScroll.8K-EtYKb.js";import{g as k}from"./layoutHelpers.DmHfmlAk.js";import"./useVisibility.B-3m_lqm.js";import"./IntersectionObserver.CmZxnn85.js";const F=700,$=14,j=$*1e3,U=28,Y=4,G=220,V=16,X=2200,J=450,K=750;function Q(){const[o,r]=s.useState(!1);return s.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia>"u")return;const f=window.matchMedia("(min-width: 1024px)"),g=p=>{r(p.matches)};return g(f),typeof f.addEventListener=="function"?(f.addEventListener("change",g),()=>f.removeEventListener("change",g)):(f.addListener(g),()=>f.removeListener(g))},[]),o}function Z({item:o,mediaEntry:r,totalSlides:f,activeIndex:g,onCycleComplete:p,autoplayEnabled:i=!0,isActive:C,shouldUseDesktopEager:x,onImageLoad:S}){const m=s.useRef(null),[v,d]=s.useState(!1),T=s.useRef(!1),[a,h]=s.useState(!1),[E,M]=s.useState(j);s.useRef(0);const N=s.useCallback(e=>{const t=Math.max(0,e.scrollHeight-e.clientHeight);if(t<=0)return 0;const n=t/$;return!Number.isFinite(n)||n<=0?U:Math.max(U,n)},[]),_=s.useCallback(e=>{const t=Math.max(0,e.scrollHeight-e.clientHeight);if(t<=0)return j;const n=N(e);if(n<=0)return j;const w=Math.round(t/n*1e3);return!Number.isFinite(w)||w<=0?j:Math.max(j,w)},[N]),R=W({ref:m,active:i&&a,speed:N,loop:!1,startDelay:F,resumeDelay:600,resumeOnUserInput:!0,threshold:.05,resetOnInactive:!1});s.useEffect(()=>{i&&(R.resetPosition(0),m.current?.scrollTo({top:0,left:0,behavior:"auto"}))},[i,R.resetPosition]),s.useEffect(()=>{const e=m.current;if(!e)return;const t=e.querySelector("picture img")??e.querySelector("img");if(!t){d(!0);return}if(t.complete&&t.naturalHeight>0){d(!0);return}d(!1);const n=()=>d(!0);return t.addEventListener("load",n,{once:!0}),t.addEventListener("error",n,{once:!0}),()=>{t.removeEventListener("load",n),t.removeEventListener("error",n)}},[o,r]),s.useEffect(()=>{v&&S&&!T.current&&(T.current=!0,S())},[v,S]),s.useEffect(()=>{if(!v){h(!1);return}const e=m.current;if(!e)return;let t=!1,n=null;const w=()=>Math.max(0,e.scrollHeight-e.clientHeight)>Y,A=()=>{t||(t=!0,n?.(),n=null,h(!0))},b=()=>{if(typeof ResizeObserver>"u"){A();return}let u=null,I=e.scrollHeight;const P=()=>{u||(u=window.setTimeout(()=>{u=null,A()},G))},q=()=>{u&&(window.clearTimeout(u),u=null)},z=new ResizeObserver(()=>{const H=e.scrollHeight;Math.abs(H-I)>V&&(I=H,q()),P()});z.observe(e),P(),n=()=>{z.disconnect(),u&&(window.clearTimeout(u),u=null)}};if(w())b();else if(typeof ResizeObserver<"u"){const u=new ResizeObserver(()=>{w()&&(u.disconnect(),b())});u.observe(e),n=()=>u.disconnect()}else A();const B=window.setTimeout(()=>{A()},X);return()=>{n?.(),window.clearTimeout(B)}},[v]),s.useEffect(()=>{if(!a||!i){M(j);return}const e=m.current;if(!e)return;const t=()=>M(_(e));t();const n=typeof ResizeObserver<"u"?new ResizeObserver(()=>t()):null;return n?.observe(e),()=>n?.disconnect()},[a,_]),s.useEffect(()=>{if(!a||!i||f<=1||R.paused)return;const e=F+E+J,t=window.setTimeout(()=>p(),e);return()=>window.clearTimeout(t)},[i,a,p,E,f,R.paused]),s.useEffect(()=>{},[a,C]);const y=k(o.featuredImage)||k(o.bannerImage)||k(o.image)||"",L=!!(r?.desktopEager&&x),O=L?"eager":r?.loading??"lazy",D=L?"high":r?.fetchPriority??"auto",c=()=>r?.sources?.length?l.jsxs("picture",{children:[r.sources.map((e,t)=>l.jsx("source",{srcSet:e.srcSet,sizes:e.sizes??r.sizes,type:e.type},`${o.slug??o.id??t}-source-${t}`)),l.jsx("img",{src:r.src,srcSet:r.srcSet,sizes:r.sizes,alt:r.alt||o.alt||o.title||"Project preview",width:r.width,height:r.height,loading:O,decoding:r.decoding??"async",fetchPriority:D,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"})]}):r?.src?l.jsx("img",{src:r.src,srcSet:r.srcSet,sizes:r.sizes,alt:r.alt||o.alt||o.title||"Project preview",width:r.width,height:r.height,loading:O,decoding:r.decoding??"async",fetchPriority:D,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"}):y?l.jsx("img",{src:y,alt:o.alt||o.title||"Project preview",loading:L?"eager":"lazy",draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top",decoding:"async",fetchPriority:L?"high":"auto"}):l.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-b from-bg2 via-bg to-bg/80 text-white/30",children:"Preview coming soon"});return l.jsx("div",{className:"relative h-full w-full",children:l.jsxs("div",{className:"relative h-full bg-bg3",children:[l.jsx("div",{className:"flex flex-col gap-3 border-b border-white/10 px-4 py-3 text-white/70 sm:flex-row sm:items-center sm:justify-between",children:l.jsx("div",{className:"flex items-center gap-3 text-xs uppercase tracking-[0.35em] text-white/50",children:l.jsxs("span",{className:"flex items-center gap-1.5",children:[l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"})]})})}),l.jsx("figure",{ref:m,className:"relative h-full overflow-y-auto overscroll-contain bg-black/40",style:{WebkitOverflowScrolling:"touch"},children:c()}),!1]})})}function le({items:o=[],className:r="",mediaEntries:f=[],staticContainerId:g,carouselContainerId:p}){const i=s.useMemo(()=>Array.isArray(o)?o:[],[o]),C=s.useMemo(()=>Array.isArray(f)?f:[],[f]),[x,S]=s.useState(0),[m,v]=s.useState(null),[d,T]=s.useState("idle"),a=s.useRef(null),h=s.useRef(null),E=Q(),[M,N]=s.useState(!1),_=s.useRef(!1),R=s.useCallback(()=>{if(_.current)return;_.current=!0;const c=g?document.getElementById(g):null,e=p?document.getElementById(p):null;e&&e.classList.remove("opacity-0","pointer-events-none","absolute","inset-0"),c&&(c.style.display="none"),N(!0)},[g,p]);s.useEffect(()=>{if(!i.length){S(0),v(null),T("idle");return}S(c=>c>=i.length?0:c)},[i.length]),s.useEffect(()=>()=>{a.current&&(window.clearTimeout(a.current),a.current=null),h.current&&(cancelAnimationFrame(h.current),h.current=null)},[]);const y=s.useCallback(c=>{typeof window>"u"||(v(x),S(c),T("pre"),h.current&&(cancelAnimationFrame(h.current),h.current=null),h.current=requestAnimationFrame(()=>{h.current=requestAnimationFrame(()=>{T("animating")})}),a.current&&(window.clearTimeout(a.current),a.current=null),a.current=window.setTimeout(()=>{T("idle"),v(null)},K))},[x]),L=s.useCallback(()=>{if(!i.length||i.length<=1||d!=="idle")return;const c=(x+1)%i.length;y(c)},[x,i.length,y,d]);if(!i.length)return null;const O="absolute inset-0 transition-transform transition-opacity duration-[750ms] ease-[cubic-bezier(0.4,0,0.2,1)]";return l.jsx("div",{className:`relative ${r}`.trim(),children:l.jsx("div",{className:"relative mx-auto w-full max-w-4xl overflow-hidden rounded-lg h-[420px] sm:h-[500px]",children:i.map((c,e)=>{const t=e===x,n=e===m,w=t||n&&d!=="idle";if(!(t||n&&d!=="idle"))return null;let b="translate-x-full";return n&&d!=="idle"?b="-translate-x-full":t&&(d==="idle"||m===null?b="translate-x-0":d==="pre"?b="translate-x-full":b="translate-x-0"),l.jsx("div",{className:`${O} shadow-2xl ${b} ${w?"opacity-100":"opacity-0 pointer-events-none"}`,"aria-hidden":t?"false":"true",children:l.jsx(Z,{item:c,mediaEntry:C[e],totalSlides:i.length||1,activeIndex:e,onCycleComplete:L,autoplayEnabled:t&&d==="idle"&&M,isActive:t,shouldUseDesktopEager:E,onImageLoad:e===0?R:void 0})},c.slug??c.id??e)})})})}export{le as default};
