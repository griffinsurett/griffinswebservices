import{j as e,r as i}from"./react-core.LlkHSr3O.js";import{B as Y}from"./accordion.ev1dK2zY.js";import"./scroll-observer.BBND9qH0.js";import"./ui-primitives.BKGTeMpG.js";import"./visibility-hooks.DxJd0gvu.js";import"./engagement-hooks.odugbDiS.js";const Z={success:"bg-green-50 text-green-800 border border-green-200",error:"bg-red-50 text-red-800 border border-red-200",loading:"bg-primary/10 text-primary border border-primary-200"},B={success:"✓",error:"⚠️",loading:""};function F({type:r,children:n,onDismiss:d}){return r==="loading"?e.jsxs("div",{className:"flex items-center justify-center p-4 mb-4",role:"status","aria-live":"polite",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-MainDark"}),e.jsx("span",{className:"ml-3 text-text",children:n})]}):e.jsx("div",{className:`p-4 rounded-lg mb-4 ${Z[r]}`,role:"alert","aria-live":"polite",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"flex-shrink-0","aria-hidden":"true",children:B[r]}),e.jsx("div",{className:"flex-1",children:n})]}),d&&e.jsx("button",{type:"button",onClick:d,className:"flex-shrink-0 ml-4 text-current opacity-50 hover:opacity-100 transition-opacity","aria-label":"Dismiss message",children:"✕"})]})})}function ee({children:r,onDismiss:n}){return e.jsx(F,{type:"success",onDismiss:n,children:r})}function re({children:r,onDismiss:n}){return e.jsx(F,{type:"error",onDismiss:n,children:r})}function te({children:r}){return e.jsx(F,{type:"loading",children:r})}const se=i.createContext(null);function ne({name:r,label:n,children:d,required:b=!1,containerClassName:v="mb-4",labelClassName:N="flex items-center gap-1.5 cursor-pointer",checkboxClassName:S="w-4 h-4 text-primary border-surface accent-accent rounded mt-0.5",...w}){const f=d??n;return e.jsx("div",{className:v,children:e.jsxs("label",{className:N,children:[e.jsx("input",{type:"checkbox",id:r,name:r,className:S,required:b,...w}),f&&e.jsxs("span",{className:"text-text",children:[f,b&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})]})})}function ue({children:r,onSubmit:n,formAction:d,formMethod:b="post",useNativeFormSubmission:v=!1,successMessage:N="Form submitted successfully!",errorMessage:S="An error occurred. Please try again.",loadingMessage:w="Submitting your form...",resetOnSuccess:f=!0,className:L="",onSuccess:R,onError:U,includeTermsCheckbox:_=!0,termsCheckboxLabel:$,termsCheckboxName:q="terms-agreement",privacyPolicyUrl:z="/privacy-policy",termsOfServiceUrl:W="/terms-of-service",submitButton:u}){const[l,k]=i.useState(!1),[C,g]=i.useState("idle"),[h,y]=i.useState(null),[t,j]=i.useState(0),[G,H]=i.useState(0),M=i.useRef(null),E=i.Children.toArray(r).filter(s=>i.isValidElement(s)&&s.type.displayName==="FormStep"),a=E.length>0,c=a?E.length:1;i.useEffect(()=>{a&&M.current&&M.current.focus()},[t,a]);const J=s=>{a&&j(m=>Number.isNaN(s)?m:Math.max(0,Math.min(c-1,s)))},D=()=>{t<c-1&&j(s=>s+1)},I=()=>{t>0&&j(s=>s-1)},K=v&&!!d,O=async s=>{if(!n)throw new Error("Form submission handler is not configured.");s.preventDefault();const m=s.currentTarget;if(!m.checkValidity()){m.reportValidity();return}const V=new FormData(m);try{k(!0),g("submitting"),y(null);const o={};V.forEach((x,p)=>{const A=V.getAll(p);A.length>1?o[p]=A:m.querySelector(`[name="${p}"][type="checkbox"]`)?o[p]=x==="on":o[p]=x}),await n(o),g("success"),y(N),f&&(m.reset(),j(0),H(x=>x+1)),R?.()}catch(o){g("error");const x=o instanceof Error?o.message:S;y(x),U?.(o instanceof Error?o:new Error("Unknown error"))}finally{k(!1)}},P=()=>{y(null),g("idle")},T=()=>a?E[t]:r,Q=e.jsxs(e.Fragment,{children:["I agree to the"," ",e.jsx("a",{href:W,target:"_blank",rel:"noopener noreferrer",className:"text-accent hover:underline",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:z,target:"_blank",rel:"noopener noreferrer",className:"text-accent hover:underline",children:"Privacy Policy"})]}),X=i.useMemo(()=>({isMultiStep:a,currentStep:t,totalSteps:c,isFirstStep:t===0,isLastStep:t===c-1,isSubmitting:l,nextStep:D,previousStep:I,goToStep:J}),[t,l,a,c]);return e.jsx(se.Provider,{value:X,children:e.jsxs("form",{action:d,method:b,onSubmit:K?void 0:O,className:L,noValidate:!1,children:[C==="submitting"&&e.jsx(te,{children:w}),C==="success"&&h&&e.jsx(ee,{onDismiss:P,children:h}),C==="error"&&h&&e.jsx(re,{onDismiss:P,children:h}),a?e.jsx("div",{ref:M,tabIndex:-1,"aria-live":"polite","aria-atomic":"true",className:"outline-none",children:T()}):T(),_&&(!a||t===c-1)&&e.jsx("div",{className:"relative z-10",children:e.jsx(ne,{name:q,required:!0,containerClassName:"mt-2 mx-1",children:$??Q})}),!a&&u&&e.jsx("div",{className:"mt-6",children:e.jsx(Y,{type:"submit",variant:u.variant??"primary",disabled:l||u.disabled,className:u.className,children:l?u.loadingText??"Submitting...":u.text??"Submit"})}),a&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t",children:[t>0?e.jsx("button",{type:"button",onClick:I,disabled:l,className:"px-6 py-2 border border-surface rounded-lg text-text hover:bg-text/5 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}):e.jsx("div",{}),e.jsxs("div",{className:"text-sm text-text",children:["Step ",t+1," of ",c]}),t<c-1?e.jsx("button",{type:"button",onClick:D,disabled:l,className:"px-6 py-2 bg-primary text-bg rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"}):e.jsx("button",{type:"submit",disabled:l,className:"px-6 py-2 bg-green-600 text-bg rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Submitting...":"Submit"})]})]},G)})}export{ue as default};
