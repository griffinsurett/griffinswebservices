import{r as t,j as l}from"./react-core.QUkC7_l_.js";import{u as B}from"./useEngagementAutoScroll.BGvpoabc.js";import{g as O}from"./layoutHelpers.DmHfmlAk.js";import"./useVisibility.DvIPLVSp.js";import"./IntersectionObserver.D8MTFmUg.js";const z=700,U=14,j=U*1e3,H=28,q=4,W=220,Y=16,G=2200,V=450,X=750;function J(){const[o,r]=t.useState(!1);return t.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia>"u")return;const u=window.matchMedia("(min-width: 1024px)"),g=w=>{r(w.matches)};return g(u),typeof u.addEventListener=="function"?(u.addEventListener("change",g),()=>u.removeEventListener("change",g)):(u.addListener(g),()=>u.removeListener(g))},[]),o}function K({item:o,mediaEntry:r,totalSlides:u,activeIndex:g,onCycleComplete:w,autoplayEnabled:i=!0,isActive:E,shouldUseDesktopEager:S}){const m=t.useRef(null),[N,p]=t.useState(!1),[c,T]=t.useState(!1),[v,h]=t.useState(j);t.useRef(0);const _=t.useCallback(e=>{const s=Math.max(0,e.scrollHeight-e.clientHeight);if(s<=0)return 0;const n=s/U;return!Number.isFinite(n)||n<=0?H:Math.max(H,n)},[]),L=t.useCallback(e=>{const s=Math.max(0,e.scrollHeight-e.clientHeight);if(s<=0)return j;const n=_(e);if(n<=0)return j;const d=Math.round(s/n*1e3);return!Number.isFinite(d)||d<=0?j:Math.max(j,d)},[_]),R=B({ref:m,active:i&&c,speed:_,loop:!1,startDelay:z,resumeDelay:600,resumeOnUserInput:!0,threshold:.05,resetOnInactive:!1});t.useEffect(()=>{i&&(R.resetPosition(0),m.current?.scrollTo({top:0,left:0,behavior:"auto"}))},[i,R.resetPosition]),t.useEffect(()=>{const e=m.current;if(!e)return;const s=e.querySelector("picture img")??e.querySelector("img");if(!s){p(!0);return}if(s.complete&&s.naturalHeight>0){p(!0);return}p(!1);const n=()=>p(!0);return s.addEventListener("load",n,{once:!0}),s.addEventListener("error",n,{once:!0}),()=>{s.removeEventListener("load",n),s.removeEventListener("error",n)}},[o,r]),t.useEffect(()=>{if(!N){T(!1);return}const e=m.current;if(!e)return;let s=!1,n=null;const d=()=>Math.max(0,e.scrollHeight-e.clientHeight)>q,M=()=>{s||(s=!0,n?.(),n=null,T(!0))},D=()=>{if(typeof ResizeObserver>"u"){M();return}let a=null,C=e.scrollHeight;const k=()=>{a||(a=window.setTimeout(()=>{a=null,M()},W))},$=()=>{a&&(window.clearTimeout(a),a=null)},I=new ResizeObserver(()=>{const P=e.scrollHeight;Math.abs(P-C)>Y&&(C=P,$()),k()});I.observe(e),k(),n=()=>{I.disconnect(),a&&(window.clearTimeout(a),a=null)}};if(d())D();else if(typeof ResizeObserver<"u"){const a=new ResizeObserver(()=>{d()&&(a.disconnect(),D())});a.observe(e),n=()=>a.disconnect()}else M();const F=window.setTimeout(()=>{M()},G);return()=>{n?.(),window.clearTimeout(F)}},[N]),t.useEffect(()=>{if(!c||!i){h(j);return}const e=m.current;if(!e)return;const s=()=>h(L(e));s();const n=typeof ResizeObserver<"u"?new ResizeObserver(()=>s()):null;return n?.observe(e),()=>n?.disconnect()},[c,L]),t.useEffect(()=>{if(!c||!i||u<=1||R.paused)return;const e=z+v+V,s=window.setTimeout(()=>w(),e);return()=>window.clearTimeout(s)},[i,c,w,v,u,R.paused]),t.useEffect(()=>{},[c,E]);const y=O(o.featuredImage)||O(o.bannerImage)||O(o.image)||"",A=!!(r?.desktopEager&&S),f=A?"eager":r?.loading??"lazy",x=A?"high":r?.fetchPriority??"auto",b=()=>r?.sources?.length?l.jsxs("picture",{children:[r.sources.map((e,s)=>l.jsx("source",{srcSet:e.srcSet,sizes:e.sizes??r.sizes,type:e.type},`${o.slug??o.id??s}-source-${s}`)),l.jsx("img",{src:r.src,srcSet:r.srcSet,sizes:r.sizes,alt:r.alt||o.alt||o.title||"Project preview",width:r.width,height:r.height,loading:f,decoding:r.decoding??"async",fetchPriority:x,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"})]}):r?.src?l.jsx("img",{src:r.src,srcSet:r.srcSet,sizes:r.sizes,alt:r.alt||o.alt||o.title||"Project preview",width:r.width,height:r.height,loading:f,decoding:r.decoding??"async",fetchPriority:x,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"}):y?l.jsx("img",{src:y,alt:o.alt||o.title||"Project preview",loading:A?"eager":"lazy",draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top",decoding:"async",fetchPriority:A?"high":"auto"}):l.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-b from-bg2 via-bg to-bg/80 text-white/30",children:"Preview coming soon"});return l.jsx("div",{className:"relative h-full w-full",children:l.jsxs("div",{className:"relative h-full bg-bg3",children:[l.jsx("div",{className:"flex flex-col gap-3 border-b border-white/10 px-4 py-3 text-white/70 sm:flex-row sm:items-center sm:justify-between",children:l.jsx("div",{className:"flex items-center gap-3 text-xs uppercase tracking-[0.35em] text-white/50",children:l.jsxs("span",{className:"flex items-center gap-1.5",children:[l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"})]})})}),l.jsx("figure",{ref:m,className:"relative h-full overflow-y-auto overscroll-contain bg-black/40",style:{WebkitOverflowScrolling:"touch"},children:b()}),!1]})})}function se({items:o=[],className:r="",mediaEntries:u=[],staticContainerId:g,carouselContainerId:w}){const i=t.useMemo(()=>Array.isArray(o)?o:[],[o]),E=t.useMemo(()=>Array.isArray(u)?u:[],[u]),[S,m]=t.useState(0),[N,p]=t.useState(null),[c,T]=t.useState("idle"),v=t.useRef(null),h=t.useRef(null),_=J();t.useEffect(()=>{g&&document.getElementById(g)?.remove(),w&&document.getElementById(w)?.classList.remove("hidden")},[g,w]),t.useEffect(()=>{if(!i.length){m(0),p(null),T("idle");return}m(f=>f>=i.length?0:f)},[i.length]),t.useEffect(()=>()=>{v.current&&(window.clearTimeout(v.current),v.current=null),h.current&&(cancelAnimationFrame(h.current),h.current=null)},[]);const L=t.useCallback(f=>{typeof window>"u"||(p(S),m(f),T("pre"),h.current&&(cancelAnimationFrame(h.current),h.current=null),h.current=requestAnimationFrame(()=>{h.current=requestAnimationFrame(()=>{T("animating")})}),v.current&&(window.clearTimeout(v.current),v.current=null),v.current=window.setTimeout(()=>{T("idle"),p(null)},X))},[S]),R=t.useCallback(()=>{if(!i.length||i.length<=1||c!=="idle")return;const f=(S+1)%i.length;L(f)},[S,i.length,L,c]);if(!i.length)return null;const y="absolute inset-0 transition-transform transition-opacity duration-[750ms] ease-[cubic-bezier(0.4,0,0.2,1)]";return l.jsx("div",{className:`relative ${r}`.trim(),children:l.jsx("div",{className:"relative mx-auto w-full max-w-4xl overflow-hidden rounded-lg h-[420px] sm:h-[500px]",children:i.map((f,x)=>{const b=x===S,e=x===N,s=b||e&&c!=="idle";if(!(b||e&&c!=="idle"))return null;let d="translate-x-full";return e&&c!=="idle"?d="-translate-x-full":b&&(c==="idle"||N===null?d="translate-x-0":c==="pre"?d="translate-x-full":d="translate-x-0"),l.jsx("div",{className:`${y} shadow-2xl ${d} ${s?"opacity-100":"opacity-0 pointer-events-none"}`,"aria-hidden":b?"false":"true",children:l.jsx(K,{item:f,mediaEntry:E[x],totalSlides:i.length||1,activeIndex:x,onCycleComplete:R,autoplayEnabled:b&&c==="idle",isActive:b,shouldUseDesktopEager:_})},f.slug??f.id??x)})})})}export{se as default};
