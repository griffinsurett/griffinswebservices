function h(t,{threshold:e=.1,root:s=null,rootMargin:r="0px",once:i=!1,onEnter:n,onExit:o}={}){let u=!1,c=!1,d=null;return!t||typeof IntersectionObserver>"u"?{isVisible:u,hasBeenSeen:c,disconnect:()=>{}}:(d=new IntersectionObserver(v=>{const l=v[0];if(!l)return;const f=l.isIntersecting;u=f,f?(c||(c=!0),n?.(l),i&&d?.disconnect()):o?.(l)},{threshold:e,root:s,rootMargin:r}),d.observe(t),{get isVisible(){return u},get hasBeenSeen(){return c},disconnect:()=>d?.disconnect()})}function b(t){return t instanceof HTMLVideoElement?!!(t.dataset.videoSrc||t.querySelector("source[data-video-src]")):!1}function S(t){if(t.dataset.videoLoaded==="true")return!0;let e=!1;const s=t.dataset.videoSrc;return s&&t.src!==s&&(t.src=s,e=!0),t.querySelectorAll("source[data-video-src]").forEach(i=>{const n=i.dataset.videoSrc;n&&i.src!==n&&(i.src=n,e=!0)}),e&&(t.load(),t.dataset.videoLoaded="true"),e}function p(t){if(!(t.dataset.videoAutoplay!=="false"))return;const s=t.play();typeof s?.catch=="function"&&s.catch(()=>{})}function y(t){t.dataset.videoPause!=="false"&&t.pause()}function E(t){if(!b(t))return;S(t)&&p(t)}function w(t){b(t)&&y(t)}class A{observedElements=new WeakSet;disconnectors=new WeakMap;seenElements=new WeakSet;defaultThreshold;defaultRootMargin;lastScrollY=0;scrollDirection="down";constructor(e={}){this.defaultThreshold=e.defaultThreshold??.1,this.defaultRootMargin=e.defaultRootMargin??"0px 0px -50px 0px"}init(){typeof window>"u"||typeof IntersectionObserver>"u"||(window.addEventListener("scroll",this.handleScroll,{passive:!0}),requestAnimationFrame(()=>{this.observeAll(),this.setupMutationObserver()}))}handleScroll=()=>{const e=window.scrollY;this.scrollDirection=e>this.lastScrollY?"down":"up",this.lastScrollY=e};observeAll(){document.querySelectorAll("[data-animate]").forEach(r=>this.observe(r)),CSS.supports("animation-timeline: view()")||document.querySelectorAll("[data-animate-css]").forEach(i=>this.observeCSS(i))}observe(e){if(this.observedElements.has(e))return;this.observedElements.add(e);const s=e.dataset.animateOnce==="true",r=parseInt(e.dataset.animateDelay||"0",10),i=e.dataset.animateThreshold?parseFloat(e.dataset.animateThreshold):this.defaultThreshold,n=e.dataset.animateRootMargin||this.defaultRootMargin,{disconnect:o}=h(e,{threshold:i,rootMargin:n,once:s,onEnter:()=>{E(e),this.seenElements.add(e),delete e.dataset.exitDirection,r>0?setTimeout(()=>{e.dataset.visible="true"},r):e.dataset.visible="true"},onExit:()=>{!s&&this.seenElements.has(e)&&(e.dataset.exitDirection=this.scrollDirection,e.dataset.visible="false"),w(e)}});this.disconnectors.set(e,o)}observeCSS(e){if(this.observedElements.has(e))return;this.observedElements.add(e);const s=e.dataset.animateCss;s&&(e.dataset.animate=s);const r=!0,{disconnect:i}=h(e,{threshold:this.defaultThreshold,rootMargin:this.defaultRootMargin,once:r,onEnter:()=>{e.dataset.visible="true"},onExit:()=>{}});this.disconnectors.set(e,i)}setupMutationObserver(){const e=CSS.supports("animation-timeline: view()");new MutationObserver(r=>{r.forEach(i=>{i.addedNodes.forEach(n=>{n instanceof HTMLElement&&(n.hasAttribute("data-animate")&&this.observe(n),n.querySelectorAll?.("[data-animate]").forEach(o=>{this.observe(o)}),e||(n.hasAttribute("data-animate-css")&&this.observeCSS(n),n.querySelectorAll?.("[data-animate-css]").forEach(o=>{this.observeCSS(o)})))})})}).observe(document.body,{childList:!0,subtree:!0})}}let a=null;function m(t){return a||(a=new A(t),a.init(),a)}if(typeof window<"u"){const t=()=>{"requestIdleCallback"in window?window.requestIdleCallback(()=>m(),{timeout:100}):setTimeout(()=>m(),0)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()}export{h as c};
