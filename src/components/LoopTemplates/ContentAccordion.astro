---
// src/components/LoopTemplates/ContentAccordion.astro
/**
 * Astro wrapper that bridges MDX content into the React Accordion.
 * Keeps the React styling/animations intact while hiding the slot/bridge
 * ceremony from every variant that wants to render collection content.
 */

import Accordion from "@/components/LoopTemplates/Accordion";
import ContentBridge from "@/components/ContentRenderer/ContentBridge/ContentBridge.astro";
import type { IconType } from "@/content/schema";

interface ContentAccordionProps {
  items?: any[];
  allowMultiple?: boolean;
  className?: string;
  headerClassName?: string;
  showIndicator?: boolean;
  indicatorIcons?: {
    expanded?: IconType;
    collapsed?: IconType;
  };
  bridgeId?: string;
}

const {
  items = [],
  allowMultiple = false,
  className = "",
  headerClassName = "",
  showIndicator = true,
  indicatorIcons,
  bridgeId = "accordion",
} = Astro.props as ContentAccordionProps;

const safeItems = Array.isArray(items) ? items : [];
const uniqueSuffix =
  typeof crypto !== "undefined" && "randomUUID" in crypto
    ? crypto.randomUUID().slice(0, 8)
    : Math.random().toString(36).slice(2, 10);
const resolvedBridgeId = `${bridgeId}-${uniqueSuffix}`;

const mappedItems = safeItems.map((item, index) => ({
  slug: item.slug,
  title: item.title || item.data?.title || "Untitled",
  description: item.description ?? item.data?.description,
  contentSlotId: `${resolvedBridgeId}-slot-${index}`,
}));
---

{safeItems.length > 0 && (
  <ContentBridge items={safeItems} bridgeId={resolvedBridgeId}>
    <Accordion
      items={mappedItems}
      allowMultiple={allowMultiple}
      className={className}
      headerClassName={headerClassName}
      showIndicator={showIndicator}
      indicatorIcons={indicatorIcons}
      client:visible
    />
  </ContentBridge>
)}
