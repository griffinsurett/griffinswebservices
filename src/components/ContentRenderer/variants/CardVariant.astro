---
// src/components/ContentRenderer/variants/CardVariant.astro
/**
 * Card Variant styled after our legacy WebsiteTypesSection
 * Retains ContentRenderer metadata + CTA behavior while reusing FeatureCard styling.
 */

import type { BaseVariantProps } from "../ContentRenderer.types";
import CardRenderer from "@/components/LoopTemplates/CardRenderer.astro";
import SectionHeader from "@/components/SectionHeader.astro";
import Button from "@/components/Button/Button";
import { shouldShowCollectionCTA } from "../utils/helpers";

interface Props extends BaseVariantProps {
  columns?: 1 | 2 | 3 | 4;
  eyebrow?: string;
}

const {
  items = [],
  title,
  description,
  className = "",
  columns = 3,
  collectionUrl,
  collectionTitle,
  id,
  eyebrow,
} = Astro.props as Props;

const viewAllText = `Explore All ${collectionTitle || ""}`.trim();
const safeItems = Array.isArray(items) ? (items as Record<string, any>[]) : [];

const getCardClassName = (item: any = "") =>
  [item?.class ?? item?.className ?? ""].filter(Boolean).join(" ");

const getRingDuration = (item: Record<string, any>) =>
  typeof item?.ringDuration === "number" ? item.ringDuration : 800;

const showHeader = Boolean(eyebrow || title || description);
const gridMarginClass = showHeader ? "mt-12" : "";
---

<section
  id={id}
  class={`outer-section bg-bg2 relative overflow-hidden ${className}`.trim()}
>
  <div class="section-dim-border"></div>

  <div class="inner-section">
    {showHeader && (
      <SectionHeader
        title={title}
        heading={title}
        description={description}
      />
    )}

    <CardRenderer
      items={safeItems}
      columns={columns}
      className={gridMarginClass}
      getCardClassName={(item) => getCardClassName(item)}
      getRingDuration={(item) => getRingDuration(item)}
    />

    {shouldShowCollectionCTA(collectionUrl, safeItems.length) && (
      <div class="mt-12 text-center">
        <Button
          client:load
          href={collectionUrl}
          rightIcon="lu:chevron-right"
          variant="secondary"
        >
          {viewAllText}
        </Button>
      </div>
    )}
  </div>
</section>
